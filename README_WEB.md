# 光度立体渲染器 - Web 版本

## 概述

基于 Web 的光度立体渲染器，提供现代化的浏览器界面来配置渲染参数并实时预览 RGB 渲染结果。完全解决了 macOS 上的兼容性问题。

## 功能特点

- 🌐 **跨平台兼容**：基于 Web 技术，在任何现代浏览器中运行
- 🎨 **RGB 渲染**：生成高质量的 RGB 彩色图像
- ⚡ **实时进度**：详细的渲染进度条和状态显示
- 🖼️ **网格预览**：一次性展示所有渲染结果，无需翻页
- 🔍 **图像放大**：点击图像可在模态框中查看大图
- 🔧 **参数调节**：完整的渲染参数配置界面
- 📱 **响应式设计**：Bootstrap 界面，支持各种设备

## 快速开始

### 1. 安装依赖

```bash
pip install flask flask-socketio pillow
```

### 2. 启动服务器

```bash
# 方式一：直接启动
python web_render.py

# 方式二：使用启动脚本（推荐）
python start_web.py
```

### 3. 打开浏览器

访问 http://localhost:8080

## 使用说明

### 界面布局

- **左侧面板**：渲染参数配置
  - 模型和材质选择
  - 相机设置（FOV、距离）
  - 光源配置（数量、分布、强度）
  - 渲染质量选项（尺寸、采样数）

- **右侧面板**：渲染结果预览
  - 实时进度条显示
  - RGB 图像网格展示
  - 点击放大查看功能
  - 渲染状态指示器

### 参数说明

#### 模型和材质
- **物体模型**：选择 `objects/` 目录中的 .obj 文件
- **BRDF 材质**：选择 `brdfs/` 目录中的 .binary 文件

#### 相机设置
- **FOV**：相机视野角度（10-120度）
- **距离**：相机到物体的距离

#### 光源设置
- **光源数量**：渲染使用的光源数量（1-16）
- **分布模式**：
  - 半球：光源分布在物体上方的半球面
  - 圆形：光源分布在水平圆周上
  - 网格：光源按网格模式分布
- **光源距离**：光源到物体的距离
- **光源强度**：光源亮度

#### 渲染质量
- **图像尺寸**：输出图像分辨率
- **采样数 (SPP)**：每像素采样数，影响渲染质量和速度

### 渲染流程

1. **选择文件**：选择 OBJ 模型和 BRDF 材质文件
2. **配置参数**：调整相机、光源和渲染质量参数
3. **开始渲染**：点击"开始渲染"按钮
4. **观察进度**：实时查看渲染进度条和当前状态
5. **查看结果**：渲染完成后自动显示所有 RGB 图像
6. **放大查看**：点击任意图像在模态框中查看大图

## 文件结构

```
├── web_render.py          # Web 应用主文件
├── start_web.py           # 启动脚本
├── templates/
│   └── index.html         # HTML 模板
├── static/
│   └── app.js            # JavaScript 前端逻辑
├── objects/              # OBJ 模型文件目录
├── brdfs/                # BRDF 材质文件目录
└── renders/              # 渲染结果输出目录
```

## 技术栈

- **后端**：Flask + Flask-SocketIO
- **前端**：Bootstrap 5 + Vanilla JavaScript
- **实时通信**：WebSocket
- **图像处理**：Pillow (PIL)
- **渲染引擎**：Mitsuba 3

## 故障排除

### 端口占用
如果 8080 端口被占用，修改 `web_render.py` 中的端口号：
```python
socketio.run(app, host='0.0.0.0', port=8081, debug=False)
```

### 依赖问题
确保使用正确的 Python 环境：
```bash
# 如果使用 conda
python web_render.py

# 如果使用系统 Python
python3 web_render.py
```

### 文件不存在
确保 `objects/` 和 `brdfs/` 目录中有相应的文件。

## 优势对比

相比 tkinter 版本：
- ✅ 无 macOS 兼容性问题
- ✅ RGB 彩色图像渲染
- ✅ 详细的渲染进度显示
- ✅ 网格式图像预览，无需翻页
- ✅ 图像点击放大功能
- ✅ 更现代的用户界面
- ✅ 支持远程访问
- ✅ 响应式设计适配各种设备
- ✅ 实时 WebSocket 通信

## 开发说明

如需修改界面或功能：
1. 修改 `templates/index.html` 调整界面布局
2. 修改 `static/app.js` 调整前端逻辑
3. 修改 `web_render.py` 调整后端 API

重启服务器后刷新浏览器即可看到更改。