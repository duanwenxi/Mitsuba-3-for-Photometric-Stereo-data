# 光度立体渲染器 - 光场相机版本

基于 Mitsuba 3 的光度立体数据集生成工具，支持单相机和光场相机阵列两种渲染模式。

## 功能特性

### 渲染模式
- **单相机模式**: 传统的单一视角渲染
- **光场相机阵列模式**: n×n 相机阵列多视角渲染，模拟光场相机功能

### 光场相机功能
- 可配置的 n×n 相机阵列（无大小限制）
- 自定义 X/Y 方向间隔距离
- 灵活的中心位置和目标点设置
- 实时相机位置预览
- 自动计算总渲染视角数量

### 渲染特性
- 支持多种光源类型（点光源、平行光）
- 高质量 RGB 图像输出
- 法线图自动生成
- 实时渲染进度显示
- 图像预览和下载功能

## 安装要求

```bash
pip install flask flask-socketio pillow numpy mitsuba
```

## 使用方法

### 启动服务器
```bash
python web_render.py
```

访问 http://localhost:8082 打开 Web 界面。

### 光场相机设置

1. **选择相机模式**: 在"相机设置"中选择"光场相机阵列"
2. **配置阵列参数**:
   - **阵列大小**: 设置 n×n 网格大小
   - **X/Y 间隔**: 相机之间的距离间隔
   - **中心位置**: 阵列的中心坐标
   - **目标位置**: 所有相机指向的目标点
3. **预览确认**: 查看相机阵列布局预览
4. **开始渲染**: 配置光源和材质后开始渲染

### 相机位置计算

对于 n×n 阵列，相机位置按以下公式计算：

```
相机(i,j)的位置:
x = center_x + (j - (n-1)/2) × spacing_x
y = center_y + (i - (n-1)/2) × spacing_y
z = distance_z
```

## 输出文件

### 单相机模式
- `light_XX.png`: 光源图像
- `ground_truth_normal.png`: 法线图

### 光场相机模式
- `cam_XX_light_YY.png`: 相机XX的光源YY图像
- `cam_XX_ground_truth_normal.png`: 相机XX的法线图

其中 XX 为相机编号，YY 为光源编号。

## 目录结构

```
├── web_render.py           # Web 服务器主程序
├── dataset_generator.py    # 数据集生成器
├── brdf_renderer.py       # BRDF 渲染器
├── templates/
│   └── index.html         # Web 界面模板
├── static/
│   └── app.js            # 前端 JavaScript
├── objects/              # OBJ 模型文件目录
├── brdfs/               # BRDF 材质文件目录
└── renders/             # 渲染输出目录
```

## 应用场景

- **光度立体重建**: 多视角几何信息获取
- **深度估计**: 结合视差和光度信息
- **材质分析**: 不同视角的 BRDF 特性观察
- **机器学习**: 多视角训练数据集生成

## 技术实现

- **前端**: Bootstrap + JavaScript，支持实时参数预览
- **后端**: Flask + SocketIO，提供实时渲染进度反馈
- **渲染引擎**: Mitsuba 3 光线追踪，支持高质量图像输出
- **数据格式**: PNG 图像输出，支持缩略图和原图下载

## 性能建议

- **快速预览**: 2×2 阵列，低采样数 (16 SPP)
- **标准质量**: 3×3 阵列，中等采样数 (64 SPP)
- **高质量**: 5×5 或更大阵列，高采样数 (256 SPP)

渲染时间与相机数量成正比，请根据需求合理配置参数。